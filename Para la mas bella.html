<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Para el Amor de mi Vida</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #F8EFE7;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(248, 239, 231, 0.95);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            cursor: pointer; z-index: 100;
            transition: opacity 0.8s ease;
        }

        #start-icon { font-size: 80px; color: #e74c3c; animation: heartbeat 1.5s infinite; }
        #start-text { color: #7C4528; font-size: 24px; font-weight: bold; margin-top: 20px; text-align: center; padding: 0 20px;}
        #music-note { margin-top: 10px; font-size: 14px; color: #c0392b; }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        #main-content { display: none; width: 100%; height: 100vh; position: relative; }

        .ground {
            position: absolute; bottom: 0; width: 100%; height: 2px; background: #5d4037; z-index: 1;
        }

        #tree-container {
            position: absolute; bottom: 0; left: 50%;
            transform: translateX(-50%);
            transition: left 2s cubic-bezier(0.45, 0.05, 0.55, 0.95);
            width: 400px; height: 600px; pointer-events: none;
        }

        #tree-container.move-right { left: 80%; }

        #tree-svg { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; z-index: 2; 
        }

        .tree-path {
            fill: #7C4528; stroke: #7C4528; stroke-width: 1px; stroke-linejoin: round;
            clip-path: inset(100% 0 0 0);
            animation: growTrunk 2.5s ease-out forwards;
        }

        @keyframes growTrunk { to { clip-path: inset(0 0 0 0); } }

        .heart {
            position: absolute; font-size: 16px; opacity: 0; user-select: none; z-index: 10;
            will-change: transform, opacity;
        }

        @keyframes popIn {
            0% { transform: scale(0) rotate(-30deg); opacity: 0; }
            70% { transform: scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .falling-heart {
            position: absolute; user-select: none; z-index: 30; opacity: 0;
        }

        @keyframes fallTowardsText {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            100% { transform: translate(-80vw, 60vh) rotate(360deg); opacity: 0; }
        }

        #message-box {
            position: absolute; left: 8%; top: 45%; transform: translateY(-50%);
            max-width: 45%; opacity: 0; z-index: 20;
        }

        #message-box h2 { color: #c0392b; margin-bottom: 25px; font-size: 34px; font-family: 'Georgia', serif; }
        #message-text { color: #7C4528; font-size: 21px; line-height: 1.6; white-space: pre-wrap; }

        #counter { position: absolute; bottom: 10%; left: 8%; opacity: 0; z-index: 20; }
        #counter-text { color: #c0392b; font-size: 19px; font-weight: 600; margin-bottom: 8px; }
        
        #time-display {
            color: #7C4528; font-size: 24px; font-weight: 500;
            font-family: 'Courier New', Courier, monospace;
        }
    </style>
</head>
<body>
    <audio id="bg-music" loop>
        <source src="https://files.catbox.moe/mcrlz5.mp3" type="audio/mp3">
    </audio>

    <div id="start-screen">
        <div id="start-icon">❤️</div>
        <div id="start-text">¿Puedo ser tu Valentín?</div>
        <div id="music-note">Haz clic para aceptar</div>
    </div>

    <div id="main-content">
        <div class="ground"></div>
        <div id="falling-hearts-container"></div>
        
        <div id="tree-container">
            <svg id="tree-svg" viewBox="0 0 400 600" preserveAspectRatio="xMidYMax">
                <path class="tree-path" d="
                 M 190 600            Q 195 500 195 450   Q 160 430 140 400   L 135 395           Q 160 420 198 420   L 198 380
                 Q 160 360 130 330    L 125 325           Q 160 350 200 360   L 202 320
                 Q 180 280 160 250    L 155 245           Q 185 270 205 300   Q 208 250 210 180   L 212 180           Q 215 250 215 300   Q 230 280 250 250
                 L 255 245
                 Q 235 290 218 330
                 L 218 370
                 Q 250 360 280 340
                 L 285 335
                 Q 250 380 218 400
                 L 215 440
                 Q 250 430 270 410
                 L 275 405
                 Q 250 450 215 470
                 Q 215 520 220 600
                 Z" />
            </svg>
        </div>
        
        <div id="message-box">
            <h2>Para el amor de mi vida:</h2>
            <div id="message-text"></div>
        </div>

        <div id="counter">
            <div id="counter-text">Mi amor por ti comenzó hace...</div>
            <div id="time-display">Cargando...</div>
        </div>
    </div>

    <script>
        const startDate = new Date(2024, 6, 1, 0, 0, 0); 

        const message = `Si pudiera elegir un lugar seguro, sería a tu lado.

Cuanto más tiempo pasa, más cuenta me doy de que eres la persona con la que quiero compartir todos mis momentos.

Gracias por llenar mi vida de amor y alegría.

Te amo más de lo que las palabras pueden expresar. ❤️`;

        const colors = ['#c0392b', '#e74c3c', '#ff7675', '#fd79a8', '#d63031', '#e84118'];

        // Función unificada para touch y click
        function handleStart(e) {
            if (hasStarted) return;
            hasStarted = true;
            
            // 1. Efecto visual INMEDIATO (para que el usuario sepa que funcionó)
            startScreen.style.opacity = '0';
            
            // 2. Audio (intentar reproducir, pero no detener si falla)
            const audio = document.getElementById("bg-music");
            audio.volume = 0.5;
            audio.play().catch(function(error) {
                console.log("Audio no pudo iniciarse automáticamente (normal en algunos móviles):", error);
            });

            // 3. Secuencia de animación
            setTimeout(() => {
                startScreen.style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                // Esperamos un poco más para que el navegador renderice el layout
                setTimeout(createHearts, 1000); 
            }, 800);
        }

        // Agregamos ambos listeners. 'touchstart' reacciona más rápido en móvil
        startScreen.addEventListener('click', handleStart);
        startScreen.addEventListener('touchstart', handleStart, {passive: true});

        function createHearts() {
            const container = document.getElementById('tree-container');
            const totalHearts = 400; 
            
            for (let i = 0; i < totalHearts; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.innerHTML = '❤';
                    
                    const t = Math.random() * 2 * Math.PI;
                    const r = Math.sqrt(Math.random());
                    let x = 16 * Math.pow(Math.sin(t), 3) * r;
                    let y = (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t)) * r;
                    
                    const scaleFactor = 16; 
                    const posX = 200 + (x * scaleFactor);
                    const posY = 350 + (y * scaleFactor); 

                    const size = 20 + Math.random() * 40;
                    heart.style.left = (posX - size/2) + 'px';
                    heart.style.bottom = posY + 'px';
                    heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                    heart.style.fontSize = size + 'px';
                    heart.style.animation = `popIn ${0.3 + Math.random() * 0.4}s forwards`;
                    
                    container.appendChild(heart);
                }, i * 1.5);
            }

            setTimeout(moveAndShowMessage, totalHearts * 1.5 + 800);
        }

        function moveAndShowMessage() {
            document.getElementById('tree-container').classList.add('move-right');
            setTimeout(() => {
                startFallingHearts();
            }, 1000);

            setTimeout(() => {
                const msgBox = document.getElementById('message-box');
                const counter = document.getElementById('counter');
                msgBox.style.opacity = '1';
                msgBox.style.transition = 'opacity 1.5s ease';
                counter.style.opacity = '1';
                counter.style.transition = 'opacity 1.5s ease';
                typeMessage();
                startCounter();
            }, 1200);
        }

        function startFallingHearts() {
            const container = document.getElementById('falling-hearts-container');
            
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'falling-heart';
                heart.innerHTML = '❤';
                const randomLeft = 70 + Math.random() * 20; 
                const randomTop = 45 + Math.random() * 15; 
                heart.style.left = randomLeft + '%';
                heart.style.top = randomTop + '%';
                heart.style.color = colors[Math.floor(Math.random() * colors.length)];
                heart.style.fontSize = (10 + Math.random() * 15) + 'px';
                const duration = 3 + Math.random() * 2;
                heart.style.animation = `fallTowardsText ${duration}s linear forwards`;
                container.appendChild(heart);
                setTimeout(() => heart.remove(), duration * 1000);
            }, 300);
        }

        function typeMessage() {
            const textElement = document.getElementById('message-text');
            let i = 0;
            const interval = setInterval(() => {
                textElement.textContent += message[i];
                i++;
                if (i >= message.length) clearInterval(interval);
            }, 50);
        }

        function startCounter() { updateCounter(); setInterval(updateCounter, 1000); }

        function updateCounter() {
            const now = new Date();
            const diff = now - startDate;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            const pad = (n) => n.toString().padStart(2, '0');
            document.getElementById('time-display').innerHTML = 
                `${days} días <span style="color:#c0392b">${pad(hours)}</span>h <span style="color:#c0392b">${pad(minutes)}</span>m <span style="color:#c0392b">${pad(seconds)}</span>s`;
        }
    </script>
</body>
</html>